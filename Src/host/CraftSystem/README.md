#  Спецификация файла конфигурации

Для начала быстро пробежимся по спецификации разметки для описания конфигов крафтов. Используется стандартный yaml 1.2. Yaml похож на json за исключением необходимости в фигурных скобках. Разделение на объекты осуществляется с помощью отступов.
Пример взят и адаптирован [отсюда](https://gist.github.com/xputerax/70a32929bf2603ed65990cc3550902a8)

```yaml
# Это комментарий!

# Объект
person:
  # Строчные значения. Могут быть с двойными, одиночными кавычками. Или без кавычек вовсе.
  name: "Вася"
  description: Простой мужик
  occupation: 'Рабочий'
  
  # числовые значения
  age: 38
  height: 1.74 

  # exponential form
  fav_num: 1e+10

  # булево.
  male: true

  # null-значение
  flaws: null

  # список значений
  hobbies: 
    - Кушать
    - Спать
    - Рабоать
    - Отдыхать на диване

  # иной способ создать список
  movies: ['Темный рыцарь', "Обитаемый остров"]

  # список объектов
  friends:
  - name: "Колян"
    age: 42
  - {name: 'Петька', age: 22}
  -
    name: "Жорик"
    age: 33

  # длинный текст. перевод строки будет удален
  description: >
    Labore officia laborum Lorem culpa excepteur anim et. 
    Eiusmod non quis qui tempor ea proident consectetur eiusmod 
    ipsum. Enim consequat proident nisi nostrud ea occaecat 
    fugiat tempor in aliquip irure do minim. Sit esse non 
    laborum et. Minim sit non Lorem esse et quis labore 
    reprehenderit veniam minim. Consequat consequat amet enim 
    magna ea veniam fugiat nulla anim reprehenderit qui irure. 
    Qui aliqua irure sit cupidatat aute commodo cillum id.
  # с сохранением форматирования.
  signature: |
    Aiman
    PHHM Organization
    email - hejes@gmail.com

```

# Система крафтов

Крафты описываются в файлах конфигурации и автоматически загружаются при запуске сервера.
Есть несколько типов конфигураций крафтов:
- Интерактивные - когда происходит нажатие предметом по другому предмету.
- Выборочные - открываются через меню.

Выборочные в свою очередь делятся на:
- Обычные - работают как и на старой системе. Удаляются компоненты и появляются результирующие объекты.
- Строительные - при попытке создания у клиента создается объект установки, который можно крутить и вращать.
- Системные - например мясодавка.

Внутри конфигураций типы именованы следующим образом:

- default - обычный сборочный крафт с помощью меню крафтов. Прим.: сложите в одном месте 10 камней и через меню выберите "Создать каменную стену"
- building - строительный крафт. Отличается от default только возможностью предпросмотра и изменения расстановки объекта.
- system - завязанные на системах крафты. Сковородка, печь, металлургия и т.д.
- interact - интерактивный крафт. Срабатывает когда нажимаем ЛКМ чем-то по чему-то и получается новый предмет. Например, нарезка грибов, отделение мяса от костей и прочие крафты, где происходит интеракция **только между двумя** предметами.

# Описание работы системы
Условно процесс создания из крафта делится на 3 основных этапа:
1. Выбор крафта. Это делает пользователь через меню, либо система сама находит (в случае для интерактивных крафтов).
2. Система запрашивает все объекты в точке создания\интеракции вокруг создающего. Происходит сопоставление и сравнение объектов со списком, указанным в требуемых ингредиентах. Удовлетворяющие всем условиям объекты добавляются в подготовленные предметы. Если объект не соответствует одному из условий - он отбрасывается из подготовленных.
3. Подготовленные предметы удаляются, портятся или меняют свои состояния, описанные в конфигурации рецепта. После создается предмет(ы) с указанными модификаторами создания.

## Общие настройки конфига
Общие настройки описывают название, тип и принадлежность рецепта.
Каждая из конфигураций может иметь следующие настройки:
|Имя свойства|Описание|По умолчанию|
|---|---|---|
| name | Название рецепта. Отображается в меню | Берется название из класса первого объекта, создаваемого из рецепта |
| desc | Описание рецепта. Для рецептов с особыми условиями создания лучше описать их тонкости. Опционально. | ничего |
| type | Тип рецепта. Можеть быть default, system, building, interact | default |
| category | категория крафта. Отвечает за расположение рецепта в меню крафтов. | Other |
| system_specific | Спецификация системного рецепта. **ТОЛЬКО ДЛЯ** `type: system` | - |


## Ключевые настройки
Во всех крафтах есть 2 группы настроек:
- required - требуемые объекты для успешного крафта
- result - результат крафта

### required
Секция required содержит список необходимых ингредиентов для крафта.
Здесь перечисляются ингредиенты для крафта (требуемые объекты)

| Имя свойства | Описание | Значение по умолчанию |
| --- | --- | --- |
| class | Имя типа ингридиента. Должно быть унаследовано от **IDestructible**. Может быть как строчкой, так и массивом. | ничего |
| count | Количество требуемых ингредиентов. Минимум 1 | 1 |
| check_type_of | Режим проверки для class. Если false, то допускает только полное соответствие. Ингридиент должен быть такого же типа, как указано в class. Если true, то допускается этот тип и его дочерние. Например, можно сделать что для ингредиента требуется любая пища, указав IFoodItem. | true |
| destroy | Нужно ли уничтожать ингредиент при успешном создании. | true |
| condition | Позволяет вносить доп.условия валидации ингредиента. Например, можно сделать ограничение чтобы имя ингредиента начиналось с какой-то буквы, либо в ингредиенте было N-нное количество реагента. Для успешной проверки ингредиента условие должно возвращать истину. | ничего |
| hp | Минимальное хп, которое должно быть у объекта чтобы он мог быть использован как ингредиент. Может быть числом, может быть строкой в  виде процентного значения от максимального состояния предмета | без ограничений |

### result
В этом разделе описывается что получается на выходе. Может быть объектом, а может быть списком объектов (если должно крафтиться несколько разных объектов).
| Имя свойства | Описание | По умолчанию |
|---|---|---|
| class | Класснейм объекта, который будет создан | - |
| count | Количество создаваемых объектов. Свойство опционально. | 1 |
| radius | Случайный радиус от центральной позиции создания. Опционально. | 0 |
| modifiers | Заготовленные модификаторы, применяемые к скрафченным объектам | - |

### skills
Специальная секция для минимального требуемого навыка.
| Имя свойства | Описание | По умолчанию |
|---|---|---|
| NAME | Название и значение навыка, требуемого для создания. Например `cooking: 4`, что означает требует навыка готовки не меньше 4. | - |
| force_visible | Крафты, недоступные по навыку по умолчанию скрыты в крафт меню. Эта опция позволяет сделать видимыми рецепты, для которых у персонажа не хватает навыка | false |

### options
Секция опций крафта
| Имя свойства | Описание | По умолчанию |
|---|---|---|
| collect_distance | На каком расстоянии будут проверяться объекты на соответствие ингредиентам | 1 |
| craft_duration | Длительность прогресс-бара при создании. Поддерживает математические выражения, например: `rta * 2 + 1`, что означает (RealTimeAction * 2 + 1) - 1 секунда + в 2 раза медленнее чем обычное стандартное действие персонажа | rta |


# Интерактивные

```yml
- name: Резка грибов # название рецепта
  type: interact # тип крафта
  skill_requiment:
    type: skillname
    value: 1
  instrument: # раздел конфигурации предмета, которым проводится действие
    typeof: Knife
    requiments:
      hp: 20
  result:
    type: Mushroom
    count: 2
```
